{
  "name": "Allyson Debug Challenge Workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "process-order"
      },
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "id": "webhookTriggerId",
      "queue": "main",
      "executeOn": "webhook",
      "maxRuns": 0
    },
    {
      "parameters": {
        "options": {},
        "values": [
          {
            "name": "transactionId",
            "value": "={{ $helpers.uuid.v4() }}"
          },
          {
            "name": "itemDescription",
            "value": "={{ $json.productName }}"
          },
          {
            "name": "itemPrice",
            "value": "={{ $json.amount }}"
          }
        ]
      },
      "name": "Prepare Transaction Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "id": "prepareDataId",
      "queue": "main",
      "maxRuns": 0
    },
    {
      "parameters": {
        "conditions": [
          {
            "value1": "={{ $json.itemPrice }}",
            "operator": "bigger",
            "value2": "50"
          }
        ]
      },
      "name": "Check Amount",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "id": "checkAmountId",
      "queue": "main",
      "maxRuns": 0
    },
    {
      "parameters": {
        "authentication": "headers",
        "url": "https://api.allyson-dev.com/v1/orders",
        "method": "POST",
        "headers": [
          {
            "name": "X-Api-Key",
            "value": "wrong-secret-key-123"
          }
        ],
        "sendBody": "json",
        "bodyParameters": [
          {
            "name": "customer_id",
            "value": "={{ $json.userId }}"
          },
          {
            "name": "orderId",
            "value": "={{ $json.transactionIdentifier }}"
          },
          {
            "name": "description",
            "value": "={{ $json.itemDescription }}"
          },
          {
            "name": "value",
            "value": "={{ $json.itemPrice }}"
          }
        ],
        "options": {}
      },
      "name": "Process Order API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "id": "httpRequestApiId",
      "queue": "main",
      "maxRuns": 0
    },
    {
      "parameters": {
        "functionCode": "// This node attempts to parse the API response.\n// It contains errors in property access and expects a specific structure.\n\nconst apiResponse = $item.json.body; // Assuming the HTTP Request returns data in 'body'\n\n// ERROR 1: 'order_status' is likely 'status' or 'orderStatus' in real API response\n// ERROR 2: 'reference_id' is likely 'referenceId'\n// ERROR 3: 'error_message' is likely 'message'\nconst orderStatus = apiResponse.order_status; \nconst orderRef = apiResponse.reference_id;   \nconst errorMessage = apiResponse.error_message; \n\nreturn [{\n  json: {\n    apiProcessStatus: orderStatus,\n    apiReference: orderRef,\n    apiError: errorMessage\n  }\n}];"
      },
      "name": "Parse API Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "id": "parseApiResponseId",
      "queue": "main",
      "maxRuns": 0
    },
    {
      "parameters": {
        "options": {},
        "values": [
          {
            "name": "status",
            "value": "Rejected"
          },
          {
            "name": "reason",
            "value": "Amount below minimum threshold."
          },
          {
            "name": "reference",
            "value": "N/A"
          }
        ]
      },
      "name": "Low Amount Rejection",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "id": "lowAmountRejectionId",
      "queue": "main",
      "maxRuns": 0
    },
    {
      "parameters": {
        "functionCode": "// This node attempts to consolidate results from both branches.\n// It relies on potentially undefined data due to upstream errors and incorrect logic.\n\nconst allPreviousItems = $input.all(); \n\nlet finalStatus = 'Unknown';\nlet finalReference = 'N/A';\nlet finalMessage = 'No specific message.';\n\nif (allPreviousItems && allPreviousItems.length > 0) {\n  const apiResult = allPreviousItems.find(item => item.context && item.context.node && item.context.node.name === 'Parse API Response');\n  const rejectionResult = allPreviousItems.find(item => item.context && item.context.node && item.context.node.name === 'Low Amount Rejection');\n\n  // ERROR 1: apiResult.json might be missing or an error object if Parse API Response node failed.\n  // It expects apiResult.json to always have the desired properties.\n  if (apiResult && apiResult.json && apiResult.json.apiProcessStatus) {\n    finalStatus = apiResult.json.apiProcessStatus;\n    finalReference = apiResult.json.apiReference;\n    finalMessage = apiResult.json.apiError; // ERROR 2: apiError might be null/undefined, and if so, it overwrites 'No specific message.'\n  } else if (rejectionResult && rejectionResult.json) {\n    finalStatus = rejectionResult.json.status;\n    finalReference = rejectionResult.json.reference;\n    finalMessage = rejectionResult.json.reason;\n  }\n}\n\nreturn [{\n  json: {\n    overallTransactionStatus: finalStatus,\n    transactionFinalReference: finalReference,\n    processingSummaryMessage: finalMessage\n  }\n}];"
      },
      "name": "Final Output Consolidation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "id": "finalOutputId",
      "queue": "main",
      "maxRuns": 0
    }
  ],
  "connections": {
    "webhookTriggerId": {
      "main": [
        [
          {
            "node": "Prepare Transaction Data",
            "index": 0
          }
        ]
      ]
    },
    "prepareDataId": {
      "main": [
        [
          {
            "node": "Check Amount",
            "index": 0
          }
        ]
      ]
    },
    "checkAmountId": {
      "main": [
        [
          {
            "node": "Process Order API",
            "index": 0
          }
        ],
        [
          {
            "node": "Low Amount Rejection",
            "index": 0
          }
        ]
      ]
    },
    "httpRequestApiId": {
      "main": [
        [
          {
            "node": "Parse API Response",
            "index": 0
          }
        ]
      ]
    },
    "parseApiResponseId": {
      "main": [
        [
          {
            "node": "Final Output Consolidation",
            "index": 0
          }
        ]
      ]
    },
    "lowAmountRejectionId": {
      "main": [
        [
          {
            "node": "Final Output Consolidation",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "workflow": {
      "name": "Allyson Debug Challenge Workflow",
      "active": false,
      "trimLogs": false,
      "saveManualExecutions": false,
      "callerPolicy": {
        "webhook": "allow"
      },
      "nodes": {
        "Final Output Consolidation": {
          "combineAllItems": true
        }
      }
    }
  },
  "staticData": null,
  "meta": {
    "instanceId": "default",
    "workflowId": "allyson-debug-challenge-workflow-id"
  }
}